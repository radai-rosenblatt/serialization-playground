plugins {
    id "serialization-playground.java-conventions"
    id "java-library"
    id "com.google.protobuf" version "0.8.16"
    id "idea" //required for intellij to pick up on sources generated by protoc
}

dependencies {
    implementation "com.google.protobuf:protobuf-java:3.17.0" //no 3.17.1 :-(
}

protobuf {

    protoc {
        //download actual proto "compiler" from central (default would look for this on $PATH)
        artifact = "com.google.protobuf:protoc:3.17.1"
    }

    //default goes to /source instead of /sources
    //it will still emit into /main/java instead of /java/main :-(
    generatedFilesBaseDir = "${project.buildDir}/generated/sources/proto"
//
//    generateProtoTasks {
//        //docs tell you to not rely on names, so you have to do this ugly thing
//        //even though we really are only interested in the java one
//        all().each { task ->
//            task.builtins {
//                //this will be run for tasks that are not java (if any)
//                //FML this is ugly.
//                java {
//                    option "java_multiple_files=true"
//                }
//            }
//        }
//    }
}


